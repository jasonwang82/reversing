# AI 办公智能助手产品需求文档（PRD）

> 本 PRD 基于对 Claude for Excel、Claude for PowerPoint、Manus Agent 及 Shortcut 的逆向工程分析，提炼产品核心能力，以标准 PRD 格式呈现完整产品定义。

**版本**：1.0  
**日期**：2026-02-27  
**状态**：逆向还原稿

---

## 目录

1. [产品概述](#1-产品概述)
2. [用户画像](#2-用户画像)
3. [核心用户故事](#3-核心用户故事)
4. [功能需求](#4-功能需求)
5. [非功能需求](#5-非功能需求)
6. [系统架构](#6-系统架构)
7. [API 设计](#7-api-设计)
8. [安全需求](#8-安全需求)
9. [UI/UX 需求](#9-uiux-需求)
10. [数据需求](#10-数据需求)
11. [发布计划](#11-发布计划)
12. [成功指标](#12-成功指标)

---

## 1. 产品概述

### 1.1 产品愿景

打造集成于 Microsoft Office（Excel、PowerPoint）的 AI 智能助手，通过自然语言交互使用户能够高效完成数据分析、财务建模、演示文稿创作等复杂任务，同时保障用户数据安全和隐私。

### 1.2 产品目标

| 目标类型 | 具体目标 |
|---------|---------|
| 用户价值 | 将复杂 Excel/PPT 任务的完成时间缩短 70% |
| 安全合规 | 用户数据永不离开本地设备 |
| 专业性 | 达到 CFA 级别的金融建模规范 |
| 可扩展性 | 支持百万行级别数据处理 |

### 1.3 竞品对比

| 产品 | 核心优势 | 核心劣势 |
|------|---------|---------|
| Claude for Excel | 深度 Excel 集成、代码执行沙盒 | 成本高（Opus 模型）、依赖 Anthropic |
| Copilot for Excel | 微软生态整合、企业采购便利 | AI 能力相对保守 |
| Shortcut | 状态机 Agent、SpreadJS 原生 | 云端产品、非 Office 插件 |

### 1.4 产品范围

**In Scope（本期）**
- Microsoft Excel 插件（数据分析、建模、格式化）
- Microsoft PowerPoint 插件（幻灯片创作、图表生成）
- 自然语言交互界面
- Python 代码执行沙盒
- Web 搜索集成

**Out of Scope（本期）**
- Word 文档支持
- 移动端应用
- 离线模式
- 自有 LLM 训练

---

## 2. 用户画像

### 2.1 主要用户：金融分析师（FA）

**基本信息**
- 年龄：25-40 岁
- 职位：初级/中级分析师、投资经理
- 技术水平：精通 Excel，熟悉 Python 基础

**痛点**
- 构建 DCF、LBO 等复杂财务模型耗时数天
- 数据来源分散（Bloomberg、FactSet、SEC EDGAR）
- PPT 演示制作占据大量非核心工作时间
- 团队格式规范不一致，审计困难

**核心需求**
- 自然语言描述 → 自动生成标准化财务模型
- 自动整合多源金融数据
- 一键生成符合规范的投资演示文稿

### 2.2 次要用户：数据分析师（DA）

**基本信息**
- 年龄：22-35 岁
- 职位：数据分析师、BI 工程师
- 技术水平：精通 Excel/SQL，熟悉 Python

**核心需求**
- 处理 10 万行以上大数据集
- 自动生成数据透视表和可视化图表
- 编写复杂 Excel 公式和 VBA 替代方案

### 2.3 三级用户：管理层（Executive）

**基本信息**
- 年龄：35-55 岁
- 职位：VP、Director、C-Suite
- 技术水平：基础 Office 技能

**核心需求**
- 快速提问获取关键数据洞察
- 一键生成高质量汇报 PPT
- 无需了解技术细节

---

## 3. 核心用户故事

### 3.1 Excel 插件用户故事

#### US-001：构建 DCF 财务模型
**作为**金融分析师，**我想要**通过自然语言描述构建一个标准 DCF 模型，**以便**节省手动建模的时间。

**验收标准**
- [ ] 系统询问：目标公司、预测年限、折现率假设、增长假设
- [ ] 蓝色单元格标识所有输入假设
- [ ] 黑色单元格标识所有计算公式
- [ ] 负数使用括号格式 (123)
- [ ] 模型包含：收入预测、EBITDA、自由现金流、终值、NPV
- [ ] 每个 Sheet 有清晰的命名和说明

#### US-002：大数据集分析
**作为**数据分析师，**我想要**对 10 万行销售数据进行分析，**以便**找出销售趋势和异常。

**验收标准**
- [ ] 超过 1000 行自动切换到 Python 沙盒处理
- [ ] 分块读取，每块 500 行
- [ ] 分析结果写回表格（含覆盖确认）
- [ ] 自动生成数据透视表汇总
- [ ] 生成可视化图表

#### US-003：金融数据获取
**作为**分析师，**我想要**获取 Apple 过去 5 年的财务数据，**以便**进行同业比较分析。

**验收标准**
- [ ] 优先使用 SEC EDGAR 官方数据源
- [ ] 不使用未经确认的第三方来源
- [ ] 每个数据单元格附带来源注释
- [ ] URL 获取失败时明确告知用户（不静默回退）

#### US-004：网页数据导入
**作为**分析师，**我想要**从提供的 IR 页面 URL 提取财务数据，**以便**快速录入最新数据。

**验收标准**
- [ ] 仅从指定 URL 获取数据
- [ ] URL 失败（403、超时）→ 明确告知 + 建议下载 PDF 上传
- [ ] 征得用户确认后才进行 Web 搜索替代

### 3.2 PowerPoint 插件用户故事

#### US-005：创建投资演示
**作为**分析师，**我想要**从空白 PPT 创建一份专业的投资演示文稿，**以便**向委员会汇报。

**验收标准**
- [ ] 检测到空白演示文稿时，先询问配色和风格偏好
- [ ] 在幻灯片母版设置完整主题（颜色、字体、背景、装饰元素）
- [ ] 正文字号不低于 16pt，任何元素不低于 14pt
- [ ] 每张幻灯片内容不过于密集（超出时自动拆分）
- [ ] 生成后通过 `verify_slides` 检查布局问题

#### US-006：添加数据图表
**作为**用户，**我想要**在第 3 张幻灯片添加一个柱状图展示季度收入，**以便**直观呈现数据趋势。

**验收标准**
- [ ] 使用 `edit_slide_chart` 工具操作 OOXML
- [ ] 不用几何形状模拟图表
- [ ] 图表数据可编辑
- [ ] 图表颜色与演示主题一致

#### US-007：编辑现有演示
**作为**用户，**我想要**更新已有的品牌模板演示文稿，**以便**添加新内容。

**验收标准**
- [ ] 检测到 `isDefaultTheme === false` 时保留现有主题
- [ ] 新增幻灯片与现有风格完全一致
- [ ] 不修改幻灯片母版

---

## 4. 功能需求

### 4.1 对话系统

#### FR-001：自然语言理解

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-001-01 | 支持中英文混合输入 | P0 |
| FR-001-02 | 理解电子表格领域专业术语 | P0 |
| FR-001-03 | 上下文记忆（支持多轮对话） | P0 |
| FR-001-04 | 歧义识别和主动澄清 | P1 |

#### FR-002：任务规划

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-002-01 | 复杂任务（>15 步）前展示执行计划，等待确认 | P0 |
| FR-002-02 | 任务分阶段执行，每阶段完成后确认 | P0 |
| FR-002-03 | 发现错误时停止并修复，不在错误基础上继续 | P0 |
| FR-002-04 | 任务完成后进行验证回顾 | P1 |

### 4.2 Excel 功能

#### FR-003：数据读取

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-003-01 | 获取工作簿结构和元数据 | P0 |
| FR-003-02 | 获取单元格范围（值、公式、格式） | P0 |
| FR-003-03 | 以 CSV 格式获取数据（用于 Python 处理） | P0 |
| FR-003-04 | 跨表格全文搜索 | P1 |
| FR-003-05 | 获取数据透视表和图表对象 | P1 |
| FR-003-06 | 分块读取（1000 行以上强制分块） | P0 |

#### FR-004：数据写入

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-004-01 | 写入值、公式、格式到单元格 | P0 |
| FR-004-02 | 覆盖保护：覆盖有数据的单元格需确认 | P0 |
| FR-004-03 | 插入/删除/隐藏/冻结行列 | P1 |
| FR-004-04 | 创建/删除/重命名工作表 | P1 |
| FR-004-05 | 创建/更新数据透视表 | P1 |
| FR-004-06 | 创建/更新图表 | P1 |
| FR-004-07 | 调整列宽/行高 | P2 |
| FR-004-08 | 带公式转换的范围复制 | P2 |

#### FR-005：代码执行

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-005-01 | Python 沙盒执行（gVisor 隔离） | P0 |
| FR-005-02 | 支持 pandas、numpy、scipy | P0 |
| FR-005-03 | 从沙盒调用 Excel 工具（PTC） | P0 |
| FR-005-04 | asyncio.gather() 并行读取大数据 | P1 |
| FR-005-05 | 容器复用（同一会话内） | P1 |
| FR-005-06 | 5 分钟容器生命周期 | P0 |

#### FR-006：金融功能

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-006-01 | Bloomberg 函数支持（BDP/BDH/BDS） | P1 |
| FR-006-02 | FactSet 函数支持（FDS/FDSH） | P1 |
| FR-006-03 | S&P Capital IQ 函数支持（CIQ/CIQH） | P1 |
| FR-006-04 | Refinitiv 函数支持（TR） | P1 |
| FR-006-05 | 函数返回 #VALUE! 时自动回退到 Web 搜索 | P2 |

### 4.3 PowerPoint 功能

#### FR-007：幻灯片操作

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-007-01 | Office.js API 操作幻灯片元素 | P0 |
| FR-007-02 | 截图幻灯片（视觉验证） | P1 |
| FR-007-03 | 编辑/添加图表（OOXML） | P0 |
| FR-007-04 | 编辑幻灯片母版和布局 | P0 |
| FR-007-05 | 直接操作幻灯片 XML | P1 |
| FR-007-06 | 复制幻灯片 | P2 |
| FR-007-07 | 验证所有幻灯片（重叠、越界、未用占位符） | P1 |
| FR-007-08 | 读取形状文本的原始 OOXML | P1 |
| FR-007-09 | 用 OOXML 替换形状文本 | P0 |

#### FR-008：主题和样式

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-008-01 | 检测演示文稿类型（空白/自定义/模板） | P0 |
| FR-008-02 | 空白演示：在母版设置完整主题 | P0 |
| FR-008-03 | 主题包含：颜色方案、字体、背景、装饰 | P0 |
| FR-008-04 | 字号强制规范（最小 14pt，正文 16pt） | P0 |
| FR-008-05 | 颜色多样化（不默认深色背景） | P2 |

### 4.4 Web 搜索功能

| 需求ID | 描述 | 优先级 |
|--------|------|--------|
| FR-009-01 | 支持 URL 指定内容获取 | P0 |
| FR-009-02 | URL 失败时：明确告知 + 建议上传文件 | P0 |
| FR-009-03 | 金融数据：强制使用官方来源 | P0 |
| FR-009-04 | 所有 Web 来源数据添加引用注释 | P0 |
| FR-009-05 | 使用第三方来源前须征得用户确认 | P0 |

---

## 5. 非功能需求

### 5.1 性能需求

| 指标 | 目标值 | 优先级 |
|------|--------|--------|
| 简单读取操作响应时间 | < 3 秒 | P0 |
| 代码执行启动时间 | < 10 秒 | P1 |
| 最大请求超时 | 600 秒（10 分钟） | P0 |
| 单会话 max_tokens | 50,000 | P0 |
| 容器最大生命周期 | 5 分钟 | P0 |
| 大数据分块大小 | 500 行/块 | P1 |

### 5.2 可靠性需求

| 需求 | 描述 |
|------|------|
| 容器崩溃恢复 | 自动重启，保留会话上下文 |
| API 调用重试 | 指数退避，最多 3 次 |
| 覆盖保护 | 写入有数据的范围需二次确认 |
| 错误反馈 | 所有操作失败必须给出明确原因 |

### 5.3 兼容性需求

| 需求 | 目标 |
|------|------|
| Excel 版本 | Microsoft 365 及以上 |
| PowerPoint 版本 | Microsoft 365 及以上 |
| 操作系统 | Windows 10+，macOS 12+ |
| 浏览器内核 | WebView2（Windows），WKWebView（macOS） |

### 5.4 可访问性需求

- 插件界面支持键盘导航
- 错误信息语义清晰
- 支持高对比度主题

---

## 6. 系统架构

### 6.1 整体架构

```
用户设备                               Anthropic 云端
┌────────────────────────┐            ┌────────────────────────────────────┐
│ Microsoft Office       │            │ 编排层                              │
│ ┌────────────────────┐ │            │ ┌──────────────────────────────────┐│
│ │ 文档（Excel/PPT）   │ │ WebSocket  │ │ 编排器                            ││
│ └────────────┬───────┘ │ ◄────────► │ │ ├─ 接收消息 + 文档上下文           ││
│              │         │            │ │ ├─ 调用 Claude API                 ││
│ ┌────────────▼───────┐ │            │ │ ├─ 管理代码执行容器                 ││
│ │ 任务窗格           │ │            │ │ ├─ 校验工具调用                     ││
│ │ ├─ 聊天 UI        │ │            │ │ └─ 监控沙盒 .request 文件           ││
│ │ ├─ OfficeJS API   │ │            │ └──────────────────────────────────┘│
│ │ └─ WebSocket 客户端│ │            │                    │                 │
│ └────────────────────┘ │            │ ┌──────────────────▼───────────────┐│
└────────────────────────┘            │ │ gVisor 沙盒容器                   ││
                                      │ │ ├─ Python 3.11                    ││
                                      │ │ ├─ pandas / numpy / scipy         ││
                                      │ │ ├─ pfc.py（RPC 桩代码）            ││
                                      │ │ ├─ 无网络，无直接 API 访问          ││
                                      │ │ └─ 文件 IPC（.request/.response） ││
                                      │ └──────────────────────────────────┘│
                                      └────────────────────────────────────┘
```

### 6.2 RPC 通信流程

```
用户提问
   │
   ▼
OfficeJS 插件（任务窗格）
   │ HTTP POST /v1/messages（含文档上下文）
   ▼
Anthropic API
   │
   ├── Claude 生成 Python 代码
   │       │
   │       ▼
   │   容器执行 pfc.py
   │       │ 写 .request 文件
   │       ▼
   │   编排器检测到 .request
   │       │ API 暂停，返回 tool_use
   │       ▼
   OfficeJS 本地执行工具（Excel/PPT API）
   │       │ 发送 tool_result
   │       ▼
   │   编排器写 .response 文件
   │       │
   │       ▼
   │   容器恢复执行
   │
   ▼
最终响应 → 任务窗格显示结果
```

### 6.3 数据流

```
用户指令
  → [自然语言解析] → 任务分解
  → [工具调用] → 读取文档状态
  → [Claude 推理] → 生成操作计划
  → [沙盒执行] → Python 数据处理（如需）
  → [工具调用] → 写入文档
  → [验证] → 读取并确认结果
  → 返回用户
```

### 6.4 沙盒规格

| 属性 | 规格 |
|------|------|
| 隔离技术 | gVisor（runsc） |
| 操作系统 | Debian GNU/Linux 12 |
| Python | 3.11 |
| CPU | 4 核 |
| 内存 | 10 GB |
| 网络 | 完全隔离（无访问） |
| 生命周期 | 5 分钟 |
| 持久性 | 同一会话内容器复用 |

---

## 7. API 设计

### 7.1 Claude API 集成

**认证**

```http
POST /v1/messages
Authorization: Bearer {oauth_token}
anthropic-beta: oauth-2025-04-20,code-execution-2025-08-25,files-api-2025-04-14,code-execution-with-tools-2025-09-08
anthropic-dangerous-direct-browser-access: true
```

**请求结构**

```json
{
  "model": "claude-opus-4-5-20251101",
  "max_tokens": 50000,
  "stream": true,
  "container": "{container_id}",
  "metadata": {
    "user_id": "{product}/{encoded_user}"
  },
  "system": "{system_prompt}",
  "tools": [
    {
      "name": "get_range_as_csv",
      "type": "custom",
      "allowed_callers": ["direct", "code_execution_20250825"]
    }
  ],
  "messages": [
    {
      "role": "user",
      "content": [
        {"type": "text", "text": "{user_message}"},
        {"type": "text", "text": "<user_context>\n{current_context}\n</user_context>"},
        {"type": "text", "text": "<initial_state>\n{workbook_metadata}\n</initial_state>"}
      ]
    }
  ]
}
```

### 7.2 Excel 工具 API

**get_range_as_csv**

```json
{
  "name": "get_range_as_csv",
  "description": "READ. 以 CSV 字符串返回数据，适合 pandas 使用",
  "input_schema": {
    "type": "object",
    "properties": {
      "sheet_id": {"type": "integer"},
      "range": {"type": "string", "description": "如 'A1:D100'"},
      "include_headers": {"type": "boolean", "default": true},
      "start_row": {"type": "integer", "description": "分块读取起始行"},
      "max_rows": {"type": "integer", "default": 500}
    },
    "required": ["sheet_id", "range"]
  },
  "allowed_callers": ["direct", "code_execution_20250825"]
}
```

**set_cell_range**

```json
{
  "name": "set_cell_range",
  "description": "WRITE. 写入值、公式、格式到单元格范围",
  "input_schema": {
    "type": "object",
    "properties": {
      "sheet_id": {"type": "integer"},
      "range": {"type": "string"},
      "values": {"type": "array"},
      "formulas": {"type": "array"},
      "formatting": {"type": "object"},
      "allow_overwrite": {"type": "boolean", "default": false}
    },
    "required": ["sheet_id", "range"]
  },
  "allowed_callers": ["direct", "code_execution_20250825"]
}
```

### 7.3 PowerPoint 工具 API

**execute_office_js**

```json
{
  "name": "execute_office_js",
  "description": "执行 Office.js 代码操作 PowerPoint 文档",
  "input_schema": {
    "type": "object",
    "properties": {
      "code": {
        "type": "string",
        "description": "在 PowerPoint.run() 中执行的异步函数体"
      },
      "explanation": {
        "type": "string",
        "maxLength": 50,
        "description": "操作简短描述，显示在工具图标旁"
      }
    },
    "required": ["code"]
  }
}
```

**edit_slide_xml**

```json
{
  "name": "edit_slide_xml",
  "description": "直接操作幻灯片 OOXML",
  "input_schema": {
    "type": "object",
    "properties": {
      "slide_index": {"type": "number", "description": "0 基索引"},
      "code": {
        "type": "string",
        "description": "接收 { zip, markDirty } 的异步函数体"
      },
      "explanation": {"type": "string", "maxLength": 50}
    },
    "required": ["slide_index", "code"]
  }
}
```

---

## 8. 安全需求

### 8.1 数据安全

| 需求 | 实现方式 | 优先级 |
|------|---------|--------|
| 用户数据不离开本地 | Excel 操作通过本地 OfficeJS 执行 | P0 |
| 沙盒完全隔离 | gVisor 容器，无网络访问 | P0 |
| 每次工具调用审计 | `[TOOL_CALL]` 日志强制记录 | P0 |
| 破坏性操作保护 | 写入覆盖需显式 `allow_overwrite=true` | P0 |
| Token 存储安全 | 不在内存中明文存储，OAuth 流程 | P0 |

### 8.2 访问控制

| 需求 | 描述 |
|------|------|
| OAuth 2.0 认证 | 通过 Anthropic OAuth 登录 |
| 工具调用权限 | PTC 工具需 `allowed_callers` 明确授权 |
| 编排器校验 | 每次工具调用经编排器校验，非沙盒直接执行 |

### 8.3 沙盒安全约束

- 无网络访问（连出站 HTTPS 也无法发起）
- 仅文件 I/O（通过 `/tmp/srvtoolu_xxx/` 目录）
- 无法访问宿主机文件系统
- 内存上限 10GB，CPU 上限 4 核
- 5 分钟后自动销毁

### 8.4 数据来源合规

- 金融数据必须使用官方来源（SEC EDGAR、公司 IR 页面）
- 所有外部数据引用需附加来源注释
- 第三方来源使用前需用户确认

---

## 9. UI/UX 需求

### 9.1 插件任务窗格

| 元素 | 规范 |
|------|------|
| 入口 | Excel/PPT 菜单栏添加 "Claude" 选项卡 |
| 窗格宽度 | 默认 360px，可调整 |
| 对话气泡 | 用户消息右对齐（蓝色），Claude 消息左对齐（白色） |
| 工具调用展示 | 显示工具名称和简短说明（`explanation` 字段） |
| 加载状态 | 显示"正在分析..."等有意义的进度提示 |
| 错误状态 | 红色错误提示，附带可操作建议 |

### 9.2 任务规划 UI

对于复杂任务（>15 步），展示结构化执行计划：

```
📋 执行计划

阶段 1：读取现有数据结构
  → 获取工作簿元数据
  → 检查现有 Sheet 命名

阶段 2：建立假设区域
  → 创建"Assumptions"Sheet
  → 设置蓝色格式输入单元格

阶段 3：构建财务预测
  ...

[确认计划并开始执行] [修改计划]
```

### 9.3 里程碑确认 UI

每个阶段完成后展示确认提示：

```
✅ 阶段 1 完成：已读取 3 个 Sheet，共 1,247 行数据

发现：
- Sheet "Sales" 包含 2020-2024 年历史数据
- Sheet "Budget" 包含 2024 年预算

是否继续到阶段 2（建立假设区域）？

[继续] [查看详情] [取消]
```

### 9.4 进度指示

- 长时间操作显示当前步骤（如"正在处理第 5000/50000 行..."）
- 代码执行时显示运行状态
- 沙盒启动时显示预计等待时间

### 9.5 PowerPoint 特有 UI

- 截图预览功能（通过 `screenshot_slide`）
- 验证问题列表（重叠、越界）
- 幻灯片索引提示（"用户的第 3 张 = API 索引 2"）

---

## 10. 数据需求

### 10.1 会话数据

| 数据 | 存储位置 | 保留时间 |
|------|---------|---------|
| 对话历史 | 浏览器 Session Storage | 关闭窗口清除 |
| 容器 ID | 会话内存 | 5 分钟（容器生命周期） |
| 工具调用日志 | Anthropic 服务端 | 符合数据保留政策 |
| 用户 ID | 编码后元数据 | 永久 |

### 10.2 文档上下文

每次请求附带以下文档上下文：

**Excel**
```json
{
  "current_sheet_id": 1,
  "selected_ranges": ["Sheet1!A1:B10"],
  "workbook_filename": "Financial_Model.xlsx",
  "total_sheets": 3
}
```

**PowerPoint**
```json
{
  "total_slides": 12,
  "current_slide_index": 2,
  "is_default_theme": false,
  "has_content": true
}
```

### 10.3 用户记忆（Shortcut 模式）

对于支持记忆功能的部署：

```markdown
存储格式：/skills/user/user-memories/SKILL.md
记忆 ID：[mem_YYMMDD]
触发条件：
  - 用户纠正 AI 输出
  - 用户声明明确偏好
  - 用户要求记住某事
排除：任务特定上下文、临时数据
```

---

## 11. 发布计划

### 11.1 MVP（Phase 1）

**目标**：验证核心 AI + Office 集成价值

**包含功能**
- Excel 基础读写工具（get/set 单元格、CSV 导出）
- 自然语言对话界面
- 简单代码执行（无 PTC）
- Web 搜索集成
- OAuth 认证

**排除功能**
- gVisor 沙盒
- 程序化工具调用（PTC）
- PowerPoint 插件
- 金融数据集成（Bloomberg/FactSet）

**时间线**：8 周

### 11.2 Phase 2

**目标**：生产就绪，支持金融专业用户

**新增功能**
- gVisor 沙盒 + PTC（`allowed_callers`）
- 大数据集分块处理
- 金融格式规范（颜色编码、数字格式）
- 金融数据终端集成
- 任务规划 UI 和里程碑确认
- PowerPoint 插件（MVP）

**时间线**：12 周（在 Phase 1 基础上）

### 11.3 Phase 3

**目标**：完整产品，覆盖所有专业场景

**新增功能**
- PowerPoint 完整功能（OOXML 编辑、主题设置、图表）
- 幻灯片验证工具
- 记忆系统
- 技能库（SEC EDGAR、高级 API）
- 团队共享技能

**时间线**：10 周（在 Phase 2 基础上）

---

## 12. 成功指标

### 12.1 用户指标

| 指标 | 基线 | 目标（3 个月） |
|------|------|--------------|
| 日活用户（DAU） | 0 | 10,000 |
| 每用户日均对话次数 | - | ≥ 3 次 |
| 任务完成率 | - | ≥ 85% |
| 用户满意度（CSAT） | - | ≥ 4.2/5 |
| 30 日留存率 | - | ≥ 40% |

### 12.2 性能指标

| 指标 | 目标 |
|------|------|
| P50 响应时间 | < 5 秒 |
| P95 响应时间 | < 30 秒 |
| 代码执行成功率 | ≥ 95% |
| API 可用性 | 99.9% |
| 沙盒启动成功率 | ≥ 99% |

### 12.3 安全指标

| 指标 | 目标 |
|------|------|
| 数据越界事件 | 0 |
| 未授权工具调用 | 0 |
| 安全审计覆盖率 | 100%（所有工具调用） |

### 12.4 业务指标

| 指标 | 目标（6 个月） |
|------|--------------|
| 付费转化率 | ≥ 8% |
| 月收入（MRR） | $500K |
| 企业客户数 | 50 家 |
| NPS 分数 | ≥ 45 |

---

## 附录

### A. 财务格式规范（来自逆向分析）

| 元素 | 格式规范 |
|------|---------|
| 蓝色文字（#0000FF） | 硬编码输入/假设 |
| 黑色文字（#000000） | 所有公式和计算 |
| 绿色文字（#008000） | 跨 Sheet 链接 |
| 负数 | 括号：(123) 而非 -123 |
| 货币 | `$#,##0`，单位在表头 |
| 百分比 | `0.0%` 格式 |
| 大于 1000 行 | 必须用代码执行处理 |

### B. 金融数据来源白名单

**允许的数据来源（无需确认）**
- SEC EDGAR（`edgar.sec.gov`）
- 公司投资者关系页面（IR）
- 官方新闻稿

**需要用户确认的来源**
- 第三方金融网站（Seeking Alpha、Yahoo Finance 等）
- 分析师报告网站

**禁止的来源（除非用户明确要求）**
- 社交媒体
- 未注明来源的博客/论坛

### C. 已知技术限制

| 限制 | 影响 | 缓解措施 |
|------|------|---------|
| 容器 5 分钟生命周期 | 长任务中断 | 分阶段执行 + 进度保存 |
| 沙盒无网络 | 无法在容器内抓取数据 | 用 `web_search` 工具代替 |
| SpreadJS 初始 5 万行上限 | 超限写入静默失败 | 写入前先扩展行数 |
| OOXML 复杂性 | XML 出错后静默丢失文本 | 强制 `escapeXml()` + `DOMParser` |
| Office.js 限制 | 某些高级格式无法设置 | 回退到 OOXML 直接操作 |
